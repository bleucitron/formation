<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />

    <meta description="" />
    <link rel="stylesheet" type="text/css" href="../reset.css" />

    <script>
      'use strict';
      function createLi(tweet) {
        const li = document.createElement('li');
        li.textContent = tweet.text;
        return li;
      }

      function createOl(tweets) {
        const ol = document.createElement('ol');

        tweets.map(createLi).forEach(function(li) {
          ol.append(li);
        });

        return ol;
      }

      function track(event) {
        console.log(event.clientX, event.clientY);
      }

      function fetchJson(url) {
        return fetch(url).then(function(resp) {
          return resp.json();
        });
      }

      const url =
        'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets.json';

      document.addEventListener(
        'DOMContentLoaded',
        function(e) {
          fetchJson(url)
            .then(function(tweets) {
              console.log('Le tableau de tweet', tweets);

              let displayedOl = createOl(tweets);

              document.body.append(displayedOl);

              const filter = document.createElement('button');
              filter.textContent = 'To Fr';
              document.body.prepend(filter);

              const tracker = document.createElement('button');
              tracker.textContent = 'Track';
              document.body.prepend(tracker);

              let isTracking = false;

              tracker.addEventListener('click', function() {
                if (!isTracking) {
                  console.log('Track !');
                  window.addEventListener('mousemove', track);
                } else {
                  console.log('Untrack !');
                  window.removeEventListener('mousemove', track);
                }
                isTracking = !isTracking;
              });

              let isFr = false;

              filter.addEventListener('click', function() {
                const tweetsToDisplay = !isFr
                  ? tweets.filter(function(tweet) {
                      return tweet.lang === 'fr';
                    })
                  : tweets;

                filter.textContent = !isFr ? 'To Int' : 'To Fr';

                const newOl = createOl(tweetsToDisplay);

                displayedOl.replaceWith(newOl);
                displayedOl = newOl;
                isFr = !isFr;
              });

              // [6] Créer un bouton qui active le tracking de la position de la souris (event.clientX, event.clientY), et le désactive quand on reclique dessus

              // PRÉSENTATION Asynchronicité

              // PRÉSENTATION Modules

              // ### BONUS 1: LOCALSTORAGE ###
              // [1] Rajouter un bouton "fav" à chaque li

              /* [2] quand le bouton est cliqué, changer le style du li (rajouter une classe 'fav')
            + et stocker l'ensemble des id_str fav dans le localStorage */

              // [3] au chargement de la page, lire le localStorage pour favoriser les favoris.

              // ### BONUS 2: TIMING EVENEMENTS ###

              /* Faites un bouton (un peu gros) qui écoute mousedown/click/dblclick et mesure le temps de click et de doubleclick
            et affiche tempsClic1, tempsClic2, tempsDoubleClic */
            })
            .catch(function(e) {
              console.error(e);
            });
        },
        { once: true },
      );
    </script>

    <title>Touitter</title>
  </head>

  <body>
    <div>Touitter</div>
  </body>
</html>

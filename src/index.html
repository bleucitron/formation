<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />

    <meta description="" />
    <link rel="stylesheet" type="text/css" href="../style.css" />

    <script>
      'use strict';

      function fetchJson(url) {
        return fetch(url)
          .then(function(resp) {
            return resp.json();
          })
          .catch(function(e) {
            console.log('error in fetch', e);
          });
      }

      document.addEventListener(
        'DOMContentLoaded',
        function(e) {
          const url1 =
            'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets.json';
          const url2 =
            'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets2.json';

          const ps = [url1, url2].map(fetchJson);

          Promise.all(ps)
            .then(function(tweets) {
              tweets = tweets[0].concat(tweets[1]);
              console.log('Le tableau de tweet', tweets);

              // ### 2/ Twitter ###

              function createLi(tweet) {
                const li = document.createElement('li');
                li.textContent = tweet.text;
                return li;
              }

              function createOl(tweets) {
                const ol = document.createElement('ol');

                tweets.map(createLi).forEach(function(li) {
                  ol.append(li);
                });

                return ol;
              }

              let isFr = false;

              const frButton = document.createElement('button');
              frButton.textContent = 'To Fr';
              frButton.addEventListener('click', function() {
                const tweetsToDisplay = isFr
                  ? tweets
                  : tweets.filter(function(tweet) {
                      return tweet.lang === 'fr';
                    });

                frButton.textContent = isFr ? 'To Fr' : 'To Inter';

                const newOl = createOl(tweetToDisplay);
                ol.replaceWith(newOl);
                ol = newOl;
                isFr = !isFr;
              });

              let ol = createOl(tweets);

              // Créer un bouton qui active le tracking de la position de la souris (event.clientX, event.clientY), et le désactive quand on reclique dessus

              function track(e) {
                console.log('MOVE', e.clientX, e.clientY);
              }

              let isTracking = false;
              const trackingButton = document.createElement('button');
              trackingButton.textContent = 'Start tracking';

              trackingButton.addEventListener('click', function() {
                trackingButton.textContent = isTracking
                  ? 'Start tracking'
                  : 'Stop tracking';

                if (!isTracking) {
                  window.addEventListener('mousemove', track);
                } else {
                  window.removeEventListener('mousemove', track);
                }

                isTracking = !isTracking;
              });

              document.body.append(frButton);
              document.body.append(trackingButton);
              document.body.append(ol);

              // Présentation Asynchronicité

              // Ecrire une fonction 'fetchJson' qui a comme paramètre une url et qui retourne une promesses pour des tweets en utilisant fetch

              /* charger et afficher les tweets de
          'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets2.json'*/

              /* Dans le dossier 'src/vanilla', créer plusieurs fichiers avec du code
            - createTweetLi.js
            - createTweetsOl.js
            - createTrackingButton.js
            - fetchJson.js
            - main.js
          */

              // charger tout ça via des <script defer src="..."> dans le <head>

              // Présentation Modules

              /* utiliser import et export pour mettre les différents fichiers en lien, et créer le bundle.js
            Utiliser le bundle.js comme <script src=""> dans le html */

              // Ajouter les infos de la date à nos <li>

              // Ajouter les infos de l'auteur à nos <li>

              // Donner des classes à la date ainsi qu'à l'auteur pour les styliser

              // Faire un module qui contient une fonction qui crée le bouton de filtre

              // ### BONUS 1: LOCALSTORAGE ###
              // 1) Rajouter un bouton "fav" à chaque li

              /* 2) quand le bouton est cliqué, changer le style du li (rajouter une classe 'fav')
            + et stocker l'ensemble des id_str fav dans le localStorage */

              // 3) au chargement de la page, lire le localStorage pour favoriser les favoris.

              // ### BONUS 2: TIMING EVENEMENTS ###

              /* Faites un bouton (un peu gros) qui écoute mousedown/click/dblclick et mesure le temps de click et de doubleclick
            et affiche tempsClic1, tempsClic2, tempsDoubleClic */
            })
            .catch(function(e) {
              console.error(e);
            });
        },
        { once: true },
      );
    </script>

    <title>Touitter</title>
  </head>

  <body>
    <div>Touitter</div>
  </body>
</html>

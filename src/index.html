<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />

    <meta description="" />
    <link rel="stylesheet" type="text/css" href="../style.css" />

    <script>
      'use strict';

      function fetchJson(url) {
        return fetch(url).then(function(resp) {
          return resp.json();
        });
      }

      const url1 =
        'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets.json';
      const url2 =
        'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets2.json';

      document.addEventListener(
        'DOMContentLoaded',
        function(e) {
          Promise.all([fetchJson(url1), fetchJson(url2)]) // ou Promise.all([url1, url2].map(fetchJson))
            .then(function(tweets) {
              tweets = tweets[0].concat(tweets[1]);
              console.log('Le tableau de tweet', tweets);

              function createLi(t) {
                const li = document.createElement('li');
                li.textContent = t.text;
                return li;
              }

              function createOl(listeDeTweets) {
                const ol = document.createElement('ol');

                listeDeTweets.forEach(function(tweet) {
                  ol.append(createLi(tweet));
                });

                return ol;
              }

              const button = document.createElement('button');
              button.textContent = 'Click';

              document.body.append(button);

              // Créer un bouton qui active le tracking de la position de la souris (event.clientX, event.clientY), et le désactive quand on reclique dessus
              const buttonTracking = document.createElement('button');
              buttonTracking.textContent = 'Track';

              document.body.append(buttonTracking);

              let isTracking = false;

              function track(event) {
                console.log('X', event.clientX, 'Y', event.clientY);
              }
              buttonTracking.addEventListener('click', function(e) {
                if (!isTracking) {
                  console.log('Track');
                  window.addEventListener('mousemove', track);
                } else {
                  console.log('Untrack');
                  window.removeEventListener('mousemove', track);
                }

                isTracking = !isTracking;
              });

              let olInitial = createOl(tweets);

              document.body.append(olInitial);

              let isFr = false;

              button.addEventListener('click', function() {
                console.log('Click');

                const tweetsToDisplay = isFr
                  ? tweets
                  : tweets.filter(function(tweet) {
                      return tweet.lang === 'fr';
                    });

                const olNew = createOl(tweetsToDisplay);

                olInitial.replaceWith(olNew);
                olInitial = olNew;

                isFr = !isFr;
              });

              // ### BONUS 1: LOCALSTORAGE ###
              // [1] Rajouter un bouton "fav" à chaque li

              /* [2] quand le bouton est cliqué, changer le style du li (rajouter une classe 'fav')
            + et stocker l'ensemble des id_str fav dans le localStorage */

              // [3] au chargement de la page, lire le localStorage pour favoriser les favoris.

              // ### BONUS 2: TIMING EVENEMENTS ###

              /* Faites un bouton (un peu gros) qui écoute mousedown/click/dblclick et mesure le temps de click et de doubleclick
            et affiche tempsClic1, tempsClic2, tempsDoubleClic */
            })
            .catch(function(e) {
              console.error(e);
            });
        },
        { once: true },
      );
    </script>

    <title>Touitter</title>
  </head>

  <body>
    <div>Touitter</div>
  </body>
</html>
